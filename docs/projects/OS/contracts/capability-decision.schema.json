{
  "$id": "https://orket.dev/os/contracts/capability-decision.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "CapabilityDecision",
  "description": "Auditable decision record for capability enforcement. Deterministic, local-first, no tokens/signatures.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "contract_version",
    "subject",
    "action",
    "resource",
    "result",
    "reason_code",
    "evidence"
  ],
  "properties": {
    "contract_version": { "const": "kernel_api/v1" },

    "subject": { "type": "string", "minLength": 1, "description": "Principal identity (role/agent/tool runner)." },
    "action": { "type": "string", "minLength": 1, "description": "Requested action (e.g., tool.call, file.write)." },
    "resource": { "type": "string", "minLength": 1, "description": "Target resource namespace (path, tool name, dto stem)." },

    "result": { "type": "string", "enum": ["GRANT", "DENY"] },

    "reason_code": {
      "type": "string",
      "minLength": 1,
      "pattern": "^[EI]_[A-Z0-9_]+$",
      "description": "Machine code describing why the action was granted/denied."
    },

    "evidence": {
      "type": "object",
      "additionalProperties": true,
      "description": "Deterministic evidence fields (policy refs, requested permissions)."
    }
  }
}
