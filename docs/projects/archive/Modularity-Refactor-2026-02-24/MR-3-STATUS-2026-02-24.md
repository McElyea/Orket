# MR-3 Status (2026-02-24)

## Slice A Completed: Retention Policy + Default Safety Steps
## Slice B/C Completed: Dependency Policy Canonicalization + Drift Reporting
## Slice D Completed: Contract Governance Template + Workflow

## Delivered

1. Runtime retention engine:
- `orket/runtime/retention_policy.py`
- Deterministic plan generation for `smoke/`, `checks/`, `artifacts/`, `latest/`
- Safety protections:
  - never delete pinned
  - never delete latest pointers
  - keep newest smoke item per profile
  - keep newest pass/fail checks item per check-id

2. Dry-run planning script:
- `scripts/retention_plan.py`
- Generates `benchmarks/results/retention_plan.json` by default.

3. Safety validation script:
- `scripts/check_retention_policy.py`
- Validates invariants and supports `--require-safety`.

4. Tests:
- `tests/runtime/test_retention_policy.py`
- `tests/application/test_retention_scripts.py`

5. Quality workflow default steps:
- `.gitea/workflows/quality.yml`
  - build retention dry-run plan
  - enforce retention policy safety
- `tests/platform/test_quality_workflow_gates.py` updated to enforce those commands.

6. Policy documentation:
- `docs/projects/modularity-refactor/MR-3-RETENTION-POLICY.md`

7. Canonical dependency-direction contract:
- `model/core/contracts/dependency_direction_policy.json`
- Explicit top-level namespace map (no implicit `root` fallback)
- Forbidden-edge set in contract form

8. Dependency tooling hardened and unified:
- `scripts/dependency_policy.py`
- `scripts/check_dependency_direction.py`
  - loads canonical contract
  - fails unknown namespace classification
  - validates non-empty scan roots
  - emits machine-readable report to `benchmarks/results/dependency_direction_check.json`
  - enforces staged `legacy` edge budget (`warn`/`fail` modes, budget override support)
- `scripts/export_dependency_graph.py`
  - loads canonical contract
  - fails unknown namespace classification
  - includes policy metadata and forbidden-edge hit summary
  - reports `legacy` edge budget status for ratcheting

9. New policy/governance tests:
- `tests/platform/test_dependency_policy_contract.py`
- `tests/platform/test_contract_governance_docs.py`

10. Contract break governance docs:
- `docs/architecture/CONTRACT_DELTA_TEMPLATE.md`
- `docs/architecture/CONTRACT_BREAK_WORKFLOW.md`
- `docs/CONTRIBUTOR.md` updated with contract-break PR checklist requirement

11. Legacy budget ratchet activated:
- Reclassified low-volatility operational top-level modules from `legacy` to `platform` in dependency policy mapping.
- Reduced `legacy_edge_budget.max_edges` from `85` to `10`.
- Enabled fail-mode dependency gate in CI quality workflow:
  - `python scripts/check_dependency_direction.py --legacy-edge-enforcement fail`

## Default Run Commands

1. `python scripts/retention_plan.py --out benchmarks/results/retention_plan.json`
2. `python scripts/check_retention_policy.py --plan benchmarks/results/retention_plan.json --out benchmarks/results/retention_policy_check.json --require-safety`
3. `python -m pytest -q tests/runtime/test_retention_policy.py`
4. `python -m pytest -q tests/application/test_retention_scripts.py`

## Validation Snapshot

1. `python -m pytest -q`:
- 940 passed, 6 skipped

2. `python scripts/check_dependency_direction.py`:
- passed

3. `python scripts/export_dependency_graph.py`:
- passed

4. `python scripts/check_volatility_boundaries.py`:
- passed

## Remaining MR-3 Work

1. No required remaining work for refactor-cycle closeout.
2. Optional follow-up items moved to pillar-era backlog (if re-prioritized).
