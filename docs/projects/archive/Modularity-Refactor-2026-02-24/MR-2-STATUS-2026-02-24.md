# MR-2 Status (2026-02-24)

## Completed

1. Composition root factories added:
- `orket/runtime/composition.py`
- `create_engine(config)`
- `create_api_app(config)`
- `create_cli_runtime(config)`
- `create_webhook_app(config)`

2. Module/profile contracts and capability resolver added:
- `orket/core/domain/module_manifest.py`
- `orket/runtime/module_registry.py`
- Deterministic startup error payloads for unknown profile/module/capability/contract mismatch.

3. Interface startup side effects reduced:
- `orket/interfaces/api.py`
  - Engine now lazy-initialized via proxy.
  - `create_api_app(project_root=...)` compatibility factory added.
- `orket/webhook_server.py`
  - Webhook handler and webhook secret are now lazy-resolved.
  - Import no longer requires immediate webhook env secrets.
  - `create_webhook_app(require_config=...)` added for explicit fail-fast startup.

4. Entrypoint wiring through composition:
- `main.py` now uses `create_cli_runtime()`.
- `server.py` now uses `create_api_app()`.

5. Setup/profile persistence:
- `orket/cli/setup_wizard.py` now captures and saves `module_profile`.

6. Profile mapping in packaging metadata:
- `pyproject.toml` optional dependency profile groups added:
  - `profile_engine_only`
  - `profile_developer_local`
  - `profile_api_runtime`
  - `profile_api_webhook_runtime`

7. Decision node module registration seam:
- `orket/decision_nodes/registry.py`
  - `register_module_nodes(module_id, registrations)` added.

## Tests Added

1. `tests/runtime/test_module_registry.py`
- profile resolution precedence
- capability gating
- contract incompatibility errors
- composition profile enforcement

2. `tests/interfaces/test_webhook_factory.py`
- webhook module import without secrets

3. `tests/application/test_decision_node_module_registration.py`
- module node registration and unknown slot rejection

## Validation Snapshot

1. `python -m pytest -q`
- 933 passed, 6 skipped

2. `python scripts/check_dependency_direction.py`
- passed

3. `python scripts/check_volatility_boundaries.py`
- passed

## Acceptance Criteria Mapping

1. Engine-only profile can instantiate engine:
- validated via `tests/runtime/test_module_registry.py`.

2. API can be gated independently:
- `create_api_app` rejects `engine-only` profile.

3. Webhook fail-fast on selected+misconfigured startup:
- `create_webhook_app(require_config=True)` enforces config at startup.

4. Existing API/CLI contracts remain compatible:
- existing interface/application/platform suites remained green.

