{
  "version": "replay-v1",
  "vectors": [
    {
      "name": "pass-multi-turn-order-normalized-with-host-diff",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0002",
            "turn_result_digest": "2222222222222222222222222222222222222222222222222222222222222222"
          },
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "1111111111111111111111111111111111111111111111111111111111111111"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" },
          { "turn_id": "turn-0002", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] done |"
        ],
        "host_path": "C:/tmp/local/a"
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "1111111111111111111111111111111111111111111111111111111111111111"
          },
          {
            "turn_id": "turn-0002",
            "turn_result_digest": "2222222222222222222222222222222222222222222222222222222222222222"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0002", "stage": "promotion", "outcome": "PASS" },
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] host path changed |"
        ],
        "host_path": "/tmp/local/b"
      },
      "expect_outcome": "PASS"
    },
    {
      "name": "pass-mixed-issue-order-normalized",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_OUT_OF_ORDER",
            "location": "/turns/2",
            "message": "order",
            "details": {}
          },
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/0",
            "message": "orphan",
            "details": {}
          }
        ],
        "events": []
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/0",
            "message": "different human text",
            "details": {"note": "ignored by contract parity"}
          },
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_OUT_OF_ORDER",
            "location": "/turns/2",
            "message": "different message",
            "details": {}
          }
        ],
        "events": []
      },
      "expect_outcome": "PASS"
    },
    {
      "name": "pass-randomized-issue-event-input-order-normalized",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_OUT_OF_ORDER",
            "location": "/turns/2",
            "message": "x",
            "details": {}
          },
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/0",
            "message": "y",
            "details": {}
          }
        ],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_NOOP_PROMOTION] [LOC:/turn-0002] noop |",
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] pass |"
        ]
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/0",
            "message": "different",
            "details": {}
          },
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_OUT_OF_ORDER",
            "location": "/turns/2",
            "message": "different",
            "details": {}
          }
        ],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] pass alt |",
          "[INFO] [STAGE:promotion] [CODE:I_NOOP_PROMOTION] [LOC:/turn-0002] noop alt |"
        ]
      },
      "expect_outcome": "PASS"
    },
    {
      "name": "fail-stage-outcome-mismatch",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "3333333333333333333333333333333333333333333333333333333333333333"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [],
        "events": []
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "3333333333333333333333333333333333333333333333333333333333333333"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "FAIL" }
        ],
        "issues": [],
        "events": []
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["stage_outcomes"]
    },
    {
      "name": "fail-schema-version-mismatch",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [],
        "events": []
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v2",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [],
        "events": []
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["schema_version"]
    },
    {
      "name": "fail-issue-pointer-mismatch",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/0",
            "message": "orphan",
            "details": {}
          }
        ],
        "events": []
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "lsi",
            "code": "E_LSI_ORPHAN_TARGET",
            "location": "/links/declares/1",
            "message": "orphan",
            "details": {}
          }
        ],
        "events": []
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["issue_codes"]
    },
    {
      "name": "fail-event-code-multiset-drift",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] ok |",
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0002] ok |"
        ]
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [],
        "issues": [],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] ok |"
        ]
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["event_codes"]
    },
    {
      "name": "fail-mixed-turn-count-edge",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
          },
          {
            "turn_id": "turn-0002",
            "turn_result_digest": "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" },
          { "turn_id": "turn-0002", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [],
        "events": []
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [
          {
            "turn_id": "turn-0001",
            "turn_result_digest": "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
          }
        ],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [],
        "events": []
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["stage_outcomes", "turn_digests"]
    },
    {
      "name": "fail-combined-mismatch-fields-ordered",
      "run_a": {
        "run_id": "run-a",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "PASS" }
        ],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_OUT_OF_ORDER",
            "location": "/turns/2",
            "message": "x",
            "details": {}
          }
        ],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_PROMOTION_PASS] [LOC:/turn-0001] ok |"
        ]
      },
      "run_b": {
        "run_id": "run-b",
        "contract_version": "kernel_api/v1",
        "schema_version": "v1",
        "turn_digests": [],
        "stage_outcomes": [
          { "turn_id": "turn-0001", "stage": "promotion", "outcome": "FAIL" }
        ],
        "issues": [
          {
            "contract_version": "kernel_api/v1",
            "level": "FAIL",
            "stage": "promotion",
            "code": "E_PROMOTION_ALREADY_APPLIED",
            "location": "/turns/1",
            "message": "y",
            "details": {}
          }
        ],
        "events": [
          "[INFO] [STAGE:promotion] [CODE:I_NOOP_PROMOTION] [LOC:/turn-0001] noop |"
        ]
      },
      "expect_outcome": "FAIL",
      "expect_code": "E_REPLAY_EQUIVALENCE_FAILED",
      "expect_mismatch_fields": ["event_codes", "issue_codes", "stage_outcomes"]
    }
  ]
}
